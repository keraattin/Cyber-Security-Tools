{% extends 'layout.html' %}


{% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}


{% block body %}
<div class="container">
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon3">Target</span>
        </div>
        <input type="text" class="form-control" id="target" placeholder="E.g 10.0.2.1 or 10.0.2.1/24">&nbsp;
        <button type="button" class="btn btn-dark" onclick="arpScan()" id="searchButton">Search</button>
    </div>
    </hr>
    <table class="table table-hover" id="resultsTable">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Ip Address</th>
            <th scope="col">MAC Address</th>
            <th scope="col">Vendor</th>
          </tr>
        </thead>
        <tbody id="resultsTbody">
        </tbody>
      </table>
</div>
{% endblock %}


{% block scripts %}
<script type="text/javascript">
    var input = document.getElementById("target");
    input.addEventListener("keyup", function(event) {
      if (event.keyCode === 13) {
       event.preventDefault();
       document.getElementById("searchButton").click();
      }
    });
</script>

<script type="text/javascript">
    function arpScan(){
        var target = encodeURIComponent($('#target').val());
        var port = "{{ port | safe }}";
        var url = "http://localhost:"+port+"/arp_scan";
        $.ajax({
            url: url,
            type: 'GET',
            data: "target="+target,
            dataType : 'json',
            success: function(response) {
                $("#resultsTbody").empty(); //Clear Table
                var num = 0;
                for (element in response){
                    var ip_addr = response[element]["ip_addr"];
                    var mac_addr = response[element]["mac_addr"];
                    var vendor = response[element]["vendor"];

                    $('#resultsTable tbody')
                    .append(("<tr></tr>"))
                    .append($("<td></td>").text(num))
                    .append($("<td></td>").text(ip_addr))
                    .append($("<td></td>").text(mac_addr))
                    .append($("<td></td>").text(vendor))
                    num = num + 1; //Increment Index
                }
            }
        });
    } 
</script>
{% endblock %}